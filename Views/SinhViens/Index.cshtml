<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syncfusion Grid Demo</title>
    <link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/17.2.47/material.css" />

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
        }

        #Grid a {
            color: #007bff;
            cursor: pointer;
            text-decoration: none;
        }

            #Grid a:hover {
                text-decoration: underline;
            }
    </style>
</head>
<body>
    <p>
        <h1>Thêm sinh viên</h1>
        <a asp-action="Create">Create New</a>
    </p>
    <div id="Grid"></div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.syncfusion.com/ej2/17.2.47/dist/ej2.min.js"></script>
    <script src="https://cdn.syncfusion.com/ej2/17.2.47/dist/ejs.interop.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var data = @Html.Raw(Json.Serialize(Model));
            var dataSource = [];

        @foreach (var sinhVien in Model)
        {
            <text>
                    dataSource.push({
                        HoTen: '@sinhVien.HoTen',
                        NgaySinh: new Date('@sinhVien.NgaySinh').toLocaleDateString('en-GB'),
                        DienThoai: '@sinhVien.DienThoai',
                        Email: '@sinhVien.Email',
                        LopHoc_MaLop: '@sinhVien.LopHoc.MaLop',
                        ChucVu_TenChucVu: '@sinhVien.ChucVu.TenChucVu',
                        MaSV: '@sinhVien.MaSV'
                    });
            </text>
        }

                    var grid = new ej.grids.Grid({
                dataSource: dataSource,
                columns: [
                    { headerText: "STT", template: "${index}", width: 40 },
                    { field: "HoTen", headerText: "Họ Tên" },
                    { field: "NgaySinh", headerText: "Ngày Sinh" },
                    { field: "DienThoai", headerText: "Điện Thoại" },
                    { field: "Email", headerText: "Email" },
                    { field: "LopHoc_MaLop", headerText: "Mã Lớp" },
                    { field: "ChucVu_TenChucVu", headerText: "Chức Vụ" },
                    {
                        headerText: "Actions",
                        template: "<a data-action='Edit' data-id='${MaSV}'>Edit</a> | <a data-action='Details' data-id='${MaSV}'>Details</a> | <a data-action='Delete' data-id='${MaSV}'>Delete</a>"
                    }
                ],
                toolbar: ['Search', 'ExcelExport'],
                searchSettings: { fields: ['MaSV', 'HoTen', 'NgaySinh', 'DienThoai', 'Email', 'LopHoc_MaLop', 'ChucVu_TenChucVu'] },
                allowExcelExport: true,
                excelExport: (e) => {
                    if (e.data) {
                        e.dataSource = e.data;

                        var fileName = 'SinhVienData_' + new Date().toISOString().slice(0, 19).replace(/[-T:]/g, '') + '.xlsx';

                        var excelExport = new ej.excelexport.ExcelExport({
                            dataSource: e.dataSource,
                            columns: e.columns,
                            fileName: fileName
                        });

                        excelExport.exportToExcel().then(() => {
                            var link = document.createElement('a');
                            link.href = excelExport.xlsxData;
                            link.download = fileName;
                            link.click();
                        });
                    }
                },
                pageSettings: { pageSize: 10, pageCount: 5 } // Số lượng bản ghi trên mỗi trang và số lượng trang
            });

            grid.appendTo('#Grid');

            $('#Grid').on('click', 'a', function (e) {
                e.preventDefault();
                var action = $(this).data('action');
                var id = $(this).data('id');
                if (action && id) {
                    window.location.href = '@Url.Action("Index", "SinhViens")' + '/' + action + '/' + id;
                }
            });
        });
    </script>
</body>
</html>
